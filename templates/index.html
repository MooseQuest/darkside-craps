<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Craps Simulation</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Craps Strategy Simulation</h1>
        <form id="start-form">
            <div class="form-group">
                <label for="bankroll">Initial Bankroll:</label>
                <select class="form-control" id="bankroll" name="bankroll" required>
                    <option value="1000">$1000</option>
                    <option value="2000">$2000</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Start Game</button>
        </form>
        <div id="game-area" class="mt-4" style="display:none;">
            <h3>Game in Progress</h3>
            <div id="initial-bet"></div>
            <button id="roll-button" class="btn btn-secondary">Roll Dice</button>
            <div id="results" class="mt-4"></div>
            <div id="actions" class="mt-4" style="display:none;">
                <button id="continue-button" class="btn btn-success">Continue</button>
                <button id="no-bet-button" class="btn btn-warning">No Bet</button>
            </div>
            <div id="totals" class="mt-4">
                <p>Current Bet Amount: <span id="current-bets"></span></p>
                <p>Bankroll: <span id="bankroll"></span></p>
                <p>Wins: <span id="wins"></span></p>
                <p>Losses: <span id="losses"></span></p>
            </div>
        </div>
        <div id="summary" class="mt-4" style="display:none;">
            <h3>Game Summary</h3>
            <pre id="summary-results"></pre>
            <button id="reset-button" class="btn btn-secondary">Reset Game</button>
            <button id="new-game-button" class="btn btn-primary">New Game</button>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            $('#start-form').on('submit', function(event) {
                event.preventDefault();
                $.ajax({
                    url: '/start',
                    method: 'POST',
                    data: $(this).serialize(),
                    success: function(response) {
                        $('#game-area').show();
                        $('#start-form').hide();
                        $('#results').html('<h4>Initial Bankroll: ' + response.initial_bankroll + '</h4>');
                        $('#initial-bet').html('<p>Initial Bet: -$' + (response.initial_bankroll == 1000 ? '25' : '50') + ' for Don\'t Pass</p>');
                        $('#current-bets').text(response.current_bets.reduce((sum, bet) => sum + bet.bet, 0));
                        $('#bankroll').text(response.bankroll);
                        $('#wins').text(0);
                        $('#losses').text(0);
                    }
                });
            });

            $('#roll-button').on('click', function() {
                $.ajax({
                    url: '/roll',
                    method: 'POST',
                    success: function(response) {
                        $('#results').append('<p>Roll ' + response.roll_count + ': ' + response.roll_sum + '</p>');
                        if (response.status !== 'continue') {
                            $('#summary-results').html('Initial Bankroll: ' + response.summary.initial_bankroll + 
                                                       '\nFinal Bankroll: ' + response.summary.final_bankroll + 
                                                       '\nRoll Count: ' + response.summary.roll_count + 
                                                       '\nResults: ' + response.summary.results.join(', ') + 
                                                       '\nPoints Established: ' + response.summary.points_established + 
                                                       '\nPoints Hit: ' + response.summary.points_hit + 
                                                       '\nWins: ' + response.summary.wins + 
                                                       '\nLosses: ' + response.summary.losses);
                            $('#summary').show();
                            $('#game-area').hide();
                        } else {
                            $('#current-bets').text(response.current_bets.reduce((sum, bet) => sum + bet.bet, 0));
                            $('#bankroll').text(response.bankroll);
                            $('#wins').text(response.wins);
                            $('#losses').text(response.losses);
                            $('#actions').show();
                        }
                    }
                });
            });

            $('#continue-button').on('click', function() {
                $.ajax({
                    url: '/take_action',
                    method: 'POST',
                    data: { action: 'continue' },
                    success: function(response) {
                        $('#results').append('<p>Roll ' + response.roll_count + ': ' + response.roll_sum + '</p>');
                        if (response.status !== 'continue') {
                            $('#summary-results').html('Initial Bankroll: ' + response.summary.initial_bankroll + 
                                                       '\nFinal Bankroll: ' + response.summary.final_bankroll + 
                                                       '\nRoll Count: ' + response.summary.roll_count + 
                                                       '\nResults: ' + response.summary.results.join(', ') + 
                                                       '\nPoints Established: ' + response.summary.points_established + 
                                                       '\nPoints Hit: ' + response.summary.points_hit + 
                                                       '\nWins: ' + response.summary.wins + 
                                                       '\nLosses: ' + response.summary.losses);
                            $('#summary').show();
                            $('#game-area').hide();
                        } else {
                            $('#current-bets').text(response.current_bets.reduce((sum, bet) => sum + bet.bet, 0));
                            $('#bankroll').text(response.bankroll);
                            $('#wins').text(response.wins);
                            $('#losses').text(response.losses);
                            $('#actions').show();
                        }
                    }
                });
            });

            $('#no-bet-button').on('click', function() {
                $.ajax({
                    url: '/take_action',
                    method: 'POST',
                    data: { action: 'no_bet' },
                    success: function(response) {
                        $('#results').append('<p>Roll ' + response.roll_count + ': ' + response.roll_sum + '</p>');
                        if (response.status !== 'continue') {
                            $('#summary-results').html('Initial Bankroll: ' + response.summary.initial_bankroll + 
                                                       '\nFinal Bankroll: ' + response.summary.final_bankroll + 
                                                       '\nRoll Count: ' + response.summary.roll_count + 
                                                       '\nResults: ' + response.summary.results.join(', ') + 
                                                       '\nPoints Established: ' + response.summary.points_established + 
                                                       '\nPoints Hit: ' + response.summary.points_hit + 
                                                       '\nWins: ' + response.summary.wins + 
                                                       '\nLosses: ' + response.summary.losses);
                            $('#summary').show();
                            $('#game-area').hide();
                        } else {
                            $('#current-bets').text(response.current_bets.reduce((sum, bet) => sum + bet.bet, 0));
                            $('#bankroll').text(response.bankroll);
                            $('#wins').text(response.wins);
                            $('#losses').text(response.losses);
                            $('#actions').show();
                        }
                    }
                });
            });

            $('#reset-button').on('click', function() {
                $('#summary').hide();
                $('#start-form').show();
            });

            $('#new-game-button').on('click', function() {
                $('#summary').hide();
                $('#start-form').show();
                $('#game-area').hide();
                $('#results').html('');
                $('#actions').hide();
            });
        });
    </script>
</body>
</html>
